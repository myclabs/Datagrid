if(Mycsense==null||typeof(Mycsense)!="object"){var Mycsense={}}Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)};Mycsense.Datagrid=function(d,c){var a=this;this.id=d;this.domElement=$("#"+d);this.columns=[];this.rows=[];this.endpoints=[];this.canAddRows=false;if(typeof c!=="undefined"){for(var b in c){if(c.hasOwnProperty(b)){if(b=="columns"){this.addColumns(c.columns)}else{this[b]=c[b]}}}}this.addContainer=$('<div class="datagrid-add-container modal hide fade">             <div class="modal-header">                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                 <h3>Add a row</h3>             </div>             <div class="modal-body"></div>             <div class="modal-footer">                 <button type="button" class="btn btn-primary add-row-save">Save</button>                 <button type="button" class="btn" data-dismiss="modal">Cancel</button>             </div>         </div>');this.addContainer.appendTo(this.domElement)};Mycsense.Datagrid.prototype.ENDPOINT_GET="get";Mycsense.Datagrid.prototype.ENDPOINT_ADD="add";Mycsense.Datagrid.prototype.ENDPOINT_UPDATE="update";Mycsense.Datagrid.prototype.ENDPOINT_DELETE="delete";Mycsense.Datagrid.prototype.enableAddRows=function(a){this.canAddRows=a};Mycsense.Datagrid.prototype.addColumn=function(a){if(typeof a.type!=="undefined"){switch(a.type){case"Column":a=new Mycsense.Column(a.key,a.label);break;case"DateTimeColumn":a=new Mycsense.DateTimeColumn(a.key,a.label);break}}this.columns.push(a);a.setDatagrid(this)};Mycsense.Datagrid.prototype.addColumns=function(a){var b=this;$.each(a,function(c,e){var d=e;if(!(e instanceof Mycsense.Column)){d=new Mycsense.Column(e.key,e.label,e.editable,e.addable)}b.addColumn(d)})};Mycsense.Datagrid.prototype.clearRows=function(){this.rows=[]};Mycsense.Datagrid.prototype.addRow=function(a){var b=this.rows.push(a);this.displayRows();$(this).trigger("rowAdded",[b,a]);return b};Mycsense.Datagrid.prototype.addRows=function(b){var a=this;$.each(b,function(c,d){a.rows.push(d)})};Mycsense.Datagrid.prototype.deleteRow=function(b){var a=this.rows[b];this.rows.remove(b);this.displayRows();$(this).trigger("rowDeleted",[b,a])};Mycsense.Datagrid.prototype.getCellContent=function(a,b){return this.rows[b][a.key]};Mycsense.Datagrid.prototype.setCellContent=function(a,d,b){var c=this.rows[d];c[a.key]=b;this.displayRows();$(this).trigger("cellChanged",[b,d,c])};Mycsense.Datagrid.prototype.onCellChanged=function(a){$(this).bind("cellChanged",a)};Mycsense.Datagrid.prototype.onRowDeleted=function(a){$(this).bind("rowDeleted",a)};Mycsense.Datagrid.prototype.onRowAdded=function(a){$(this).bind("rowAdded",a)};Mycsense.Datagrid.prototype.render=function(){var b=this;this.domElement.empty();this.domElement.append('<table class="datagrid table table-bordered table-striped"><thead><tr></tr></thead><tbody></tbody></table>');if(this.canAddRows){var a=$('<button type="button" class="btn add-row">Add a row</button>').click(function(){b.displayAddForm()});this.domElement.append(a)}$.each(this.columns,function(c,d){var e=$("<th></th>").text(d.label);b.domElement.find("thead tr").append(e)});if(this.ENDPOINT_GET in this.endpoints){this.asyncRefreshRows()}else{this.displayRows()}};Mycsense.Datagrid.prototype.asyncRefreshRows=function(){var a=this;$.ajax({url:a.endpoints[a.ENDPOINT_GET],data:{id:a.id},success:function(b){a.clearRows();a.addRows(b);a.displayRows()},dataType:"json"})};Mycsense.Datagrid.prototype.displayRows=function(){var a=this;var b=a.domElement.find("tbody");b.empty();$.each(this.rows,function(c,e){var d=$("<tr></tr>").data("index",c);b.append(d)});$.each(this.columns,function(d,c){b.find("tr").each(function(h){var e=null;if(!(c instanceof Mycsense.DeleteColumn)){var f=a.rows[h];if(!(c.key in f)){console.error("No '"+c.key+"' found in row #"+h+" of the datagrid");e=null}else{e=f[c.key]}}var g=c.renderCell(h,e);$(this).append(g)})})};Mycsense.Datagrid.prototype.displayAddForm=function(){var b=this;var a=$('<form class="form-horizontal"></form>');$.each(this.columns,function(e,d){if(d.addable){var c=$('<div class="control-group">                 <label class="control-label">'+d.label+'</label>                 <div class="controls"></div>             </div>');c.find(".controls").data("column",d).append(d.getFormElement(""));a.append(c)}});a.submit(function(c){c.preventDefault();b.addContainer.modal("hide");var d={};$(this).find(".controls").each(function(g,e){var h=$(this).data("column");d[h.key]=h.getValueFromFormElement($(this))});var f=b.addRow(d)});this.addContainer.find(".add-row-save").unbind().click(function(){b.addContainer.find("form").submit()});this.addContainer.find(".modal-body").empty().append(a);this.addContainer.modal();a.focus()};