if(Mycsense==null||typeof(Mycsense)!="object"){var Mycsense={}}Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)};Mycsense.Datagrid=function(c,b){this.id=c;this.domElement=$("#"+c);this.columns=[];this.rows=[];this.endpoints=[];if(typeof b!=="undefined"){for(var a in b){if(b.hasOwnProperty(a)){if(a=="columns"){this.addColumns(b.columns)}else{this[a]=b[a]}}}}};Mycsense.Datagrid.prototype.ENDPOINT_GET="get";Mycsense.Datagrid.prototype.ENDPOINT_ADD="add";Mycsense.Datagrid.prototype.ENDPOINT_UPDATE="update";Mycsense.Datagrid.prototype.ENDPOINT_DELETE="delete";Mycsense.Datagrid.prototype.addColumn=function(a){if(typeof a.type!=="undefined"){switch(a.type){case"Column":a=new Mycsense.Column(a.key,a.label);break;case"DateTimeColumn":a=new Mycsense.DateTimeColumn(a.key,a.label);break}}this.columns.push(a)};Mycsense.Datagrid.prototype.addColumns=function(a){var b=this;$.each(a,function(c,e){var d=e;if(!(e instanceof Mycsense.Column)){d=new Mycsense.Column(e.key,e.label,e.editable)}b.addColumn(d);d.setDatagrid(b)})};Mycsense.Datagrid.prototype.clearRows=function(){this.rows=[]};Mycsense.Datagrid.prototype.addRow=function(a){this.rows.push(a)};Mycsense.Datagrid.prototype.addRows=function(b){var a=this;$.each(b,function(c,d){a.addRow(d)})};Mycsense.Datagrid.prototype.deleteRow=function(b){var a=this.rows[b];this.rows.remove(b);this.displayRows();$(this).trigger("rowDeleted",[b,a])};Mycsense.Datagrid.prototype.setCellContent=function(a,d,b){var c=this.rows[d];c[a.key]=b;this.displayRows();$(this).trigger("cellChanged",[b,d,c])};Mycsense.Datagrid.prototype.onCellChanged=function(a){$(this).bind("cellChanged",a)};Mycsense.Datagrid.prototype.onRowDeleted=function(a){$(this).bind("rowDeleted",a)};Mycsense.Datagrid.prototype.render=function(){var a=this;a.domElement.empty();a.domElement.append("<table class='datagrid table table-bordered table-striped'><thead><tr></tr></thead><tbody></tbody></table>");$.each(this.columns,function(b,c){var d=$("<th></th>").text(c.label);a.domElement.find("thead tr").append(d)});if(a.ENDPOINT_GET in a.endpoints){a.asyncRefreshRows()}else{a.displayRows()}};Mycsense.Datagrid.prototype.asyncRefreshRows=function(){var a=this;$.ajax({url:a.endpoints[a.ENDPOINT_GET],data:{id:a.id},success:function(b){a.clearRows();a.addRows(b);a.displayRows()},dataType:"json"})};Mycsense.Datagrid.prototype.displayRows=function(){var a=this;var b=a.domElement.find("tbody");b.empty();$.each(this.rows,function(c,e){var d=$("<tr></tr>").data("index",c);b.append(d)});$.each(this.columns,function(d,c){b.find("tr").each(function(h){var e=null;if(!(c instanceof Mycsense.DeleteColumn)){var f=a.rows[h];if(!(c.key in f)){console.error("No '"+c.key+"' found in row #"+h+" of the datagrid");return}e=f[c.key]}var g=c.renderCell(h,e);$(this).append(g)})})};